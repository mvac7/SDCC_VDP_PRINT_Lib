/* =============================================================================
   Test VDP_VPRINT Library
   v1.1 (09 September 2020)
   
   Description:
   
   History of versions:
     - v1.0 (03 February 2016)
============================================================================= */

#include "../include/newTypes.h"
#include "../include/msxSystemVariables.h"
#include "../include/msxBIOS.h"

#include "../include/memory.h"
#include "../include/VDP_TMS9918A.h"
#include "../include/VDP_VPRINT.h"



#define  HALT __asm halt __endasm   //wait for the next interrupt



// Definitions of Labels -------------------------------------------------------





// definition of functions  ----------------------------------------------------

void test_SC1();
void test_SC2();
void test();

void TwoSeconds();

void WAIT(uint cicles);
char inkey();



// constants  ------------------------------------------------------------------

const char text01[] = "Test VPRINT SDCC library";
const char text02[] = "VDP_VPRINT Lib v1.1";



// Project: mvac7_tileset_GUI_05
// tileset pattern
// Tiles range: 0 to 122
// Size= 984
const unsigned char TILESET_FONT[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x7E,0x42,0x42,0x42,0x7E,0x00,
0x78,0x4C,0x4E,0x42,0x42,0x42,0x7E,0x00,0x7F,0x7F,0x7F,0x41,0x7F,0x7F,0x7F,0x00,
0x7F,0x77,0x77,0x41,0x77,0x77,0x7F,0x00,0x7F,0x7F,0x7F,0x41,0x63,0x77,0x7F,0x7F,
0x5C,0x62,0x70,0x5E,0x42,0x42,0x7E,0x00,0xFC,0xBA,0xBA,0x82,0x82,0x82,0xFE,0x00,
0x00,0x00,0x18,0x3C,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x3C,0x18,0x00,0x00,
0x00,0x08,0x18,0x38,0x38,0x18,0x08,0x00,0x00,0x10,0x18,0x1C,0x1C,0x18,0x10,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x18,0x18,0x18,0x7E,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFF,0x18,0x18,0x18,0x18,0x18,0x18,0xF8,0xF8,0x18,0x18,0x18,
0x18,0x18,0x18,0x1F,0x1F,0x18,0x18,0x18,0x18,0x18,0x18,0xFF,0xFF,0x18,0x18,0x18,
0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0x0F,0x1F,0x1C,0x18,0x18,0x00,0x00,0x00,0xF0,0xF8,0x38,0x18,0x18,
0x18,0x18,0x1C,0x1F,0x0F,0x00,0x00,0x00,0x18,0x18,0x38,0xF8,0xF0,0x00,0x00,0x00,
0xFF,0xDD,0xEB,0xF7,0xEB,0xDD,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0xFF,0xFF,0x10,0x10,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x30,0x30,0x00,0x30,0x30,0x00,
0x28,0x28,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x28,0x7C,0x28,0x7C,0x28,0x00,
0x00,0x10,0x7C,0xD0,0x7C,0x16,0x7C,0x10,0x00,0x00,0x66,0x6C,0x18,0x36,0x66,0x00,
0x00,0x70,0xD8,0x7A,0xCC,0xCC,0x7A,0x00,0x00,0x18,0x30,0x00,0x00,0x00,0x00,0x00,
0x18,0x30,0x60,0x60,0x60,0x30,0x18,0x00,0x60,0x30,0x18,0x18,0x18,0x30,0x60,0x00,
0x00,0x00,0x5A,0x3C,0x7E,0x3C,0x5A,0x00,0x00,0x00,0x18,0x18,0x7E,0x18,0x18,0x00,
0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x20,0x00,0x00,0x00,0x00,0x7C,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x06,0x0C,0x18,0x30,0x60,0xC0,0x00,
0x7C,0xC6,0xCE,0xD6,0xE6,0xC6,0x7C,0x00,0x30,0x70,0x30,0x30,0x30,0x30,0x78,0x00,
0xFC,0x06,0x06,0x7C,0xC0,0xC0,0xFE,0x00,0xFC,0x06,0x06,0x7C,0x06,0x06,0xFC,0x00,
0xC6,0xC6,0xC6,0xFE,0x06,0x06,0x06,0x00,0xFE,0xC0,0xC0,0xFC,0x06,0x06,0xFC,0x00,
0x7C,0xC0,0xC0,0xFC,0xC6,0xC6,0x7C,0x00,0xFE,0x06,0x0C,0x18,0x30,0x30,0x30,0x00,
0x7C,0xC6,0xC6,0x7C,0xC6,0xC6,0x7C,0x00,0x7C,0xC6,0xC6,0x7E,0x06,0x06,0x7C,0x00,
0x00,0x30,0x30,0x00,0x30,0x30,0x00,0x00,0x00,0x30,0x30,0x00,0x30,0x30,0x20,0x00,
0x00,0x18,0x30,0x60,0x30,0x18,0x00,0x00,0x00,0x00,0x78,0x00,0x78,0x00,0x00,0x00,
0x00,0x60,0x30,0x18,0x30,0x60,0x00,0x00,0x3C,0x66,0x06,0x0C,0x18,0x00,0x18,0x00,
0x7C,0x82,0xBA,0xAA,0xBE,0x80,0x7C,0x00,0x7C,0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0x00,
0xFC,0xC6,0xC6,0xFC,0xC6,0xC6,0xFC,0x00,0x7E,0xC0,0xC0,0xC0,0xC0,0xC0,0x7E,0x00,
0xFC,0xC6,0xC6,0xC6,0xC6,0xC6,0xFC,0x00,0xFE,0xC0,0xC0,0xF8,0xC0,0xC0,0xFE,0x00,
0xFE,0xC0,0xC0,0xFC,0xC0,0xC0,0xC0,0x00,0x7E,0xC0,0xC0,0xCE,0xC6,0xC6,0x7E,0x00,
0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0x00,0x78,0x30,0x30,0x30,0x30,0x30,0x78,0x00,
0x3C,0x18,0x18,0x18,0x18,0xD8,0x70,0x00,0xC6,0xC6,0xCC,0xF8,0xCC,0xC6,0xC6,0x00,
0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xFE,0x00,0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0xC6,0x00,
0xC6,0xE6,0xF6,0xDE,0xCE,0xC6,0xC6,0x00,0x7C,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,
0xFC,0xC6,0xC6,0xC6,0xFC,0xC0,0xC0,0x00,0x7C,0xC6,0xC6,0xC6,0xD6,0xCC,0x7A,0x00,
0xFC,0xC6,0xC6,0xFC,0xC6,0xC6,0xC6,0x00,0x7E,0xC0,0xC0,0x7C,0x06,0x06,0xFC,0x00,
0xFC,0x30,0x30,0x30,0x30,0x30,0x30,0x00,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,
0xC6,0xC6,0xC6,0xC6,0xC6,0x6C,0x38,0x00,0xC6,0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0x00,
0xC6,0xC6,0x6C,0x38,0x6C,0xC6,0xC6,0x00,0xCC,0xCC,0xCC,0x78,0x30,0x30,0x30,0x00,
0xFE,0x06,0x0C,0x18,0x30,0x60,0xFE,0x00,0x0E,0x0C,0x0C,0x0C,0x0C,0x0C,0x0E,0x00,
0x00,0xC0,0x60,0x30,0x18,0x0C,0x06,0x00,0x38,0x18,0x18,0x18,0x18,0x18,0x38,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,0x06,0x7E,0xC6,0xFE,0x00,
0xC0,0xC0,0xFC,0xC6,0xC6,0xC6,0xFC,0x00,0x00,0x00,0x7E,0xC0,0xC0,0xC0,0x7E,0x00,
0x06,0x06,0x7E,0xC6,0xC6,0xC6,0x7E,0x00,0x00,0x00,0x7C,0xC6,0xFE,0xC0,0x7C,0x00,
0x3C,0x60,0x60,0xF8,0x60,0x60,0x60,0x00,0x00,0x00,0x7E,0xC6,0xC6,0x7E,0x06,0x7C,
0xC0,0xC0,0xFC,0xC6,0xC6,0xC6,0xC6,0x00,0x30,0x00,0x70,0x30,0x30,0x30,0x78,0x00,
0x18,0x00,0x18,0x18,0x18,0x18,0x18,0x70,0xC0,0xC0,0xC6,0xCC,0xF8,0xCC,0xC6,0x00,
0x70,0x30,0x30,0x30,0x30,0x30,0x78,0x00,0x00,0x00,0xFC,0xD6,0xD6,0xD6,0xD6,0x00,
0x00,0x00,0xDC,0xE6,0xC6,0xC6,0xC6,0x00,0x00,0x00,0x7C,0xC6,0xC6,0xC6,0x7C,0x00,
0x00,0x00,0xFC,0xC6,0xC6,0xC6,0xFC,0xC0,0x00,0x00,0x7E,0xC6,0xC6,0xC6,0x7E,0x06,
0x00,0x00,0xDC,0xE6,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x7E,0xC0,0x7C,0x06,0xFC,0x00,
0x30,0x30,0x7C,0x30,0x30,0x30,0x1C,0x00,0x00,0x00,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,
0x00,0x00,0xC6,0xC6,0xC6,0x6C,0x38,0x00,0x00,0x00,0xC6,0xD6,0xFE,0xEE,0xC6,0x00,
0x00,0x00,0xC6,0x6C,0x38,0x6C,0xC6,0x00,0x00,0x00,0xC6,0xC6,0xC6,0x7E,0x06,0x7C,
0x00,0x00,0xFC,0x18,0x30,0x60,0xFC,0x00};







// Functions -------------------------------------------------------------------


//
void main(void)
{
     
  test_SC1();
 
  test_SC2();
  

//EXIT MSXDOS
/*  screen(0);
    
__asm
 	ld b,4(ix)
	ld c,#0x62
	call 5 
__endasm;*/
//end EXIT

  return;
}



/* =============================================================================
One character input (waiting)
============================================================================= */
char inkey() __naked
{
__asm   
   call CHGET
   ld   L,A
   ret
__endasm;
}



// Generates a pause in the execution of n interruptions.
// PAL: 50 = 1 second. ; NTSC: 60 = 1 second. 
void WAIT(uint cicles)
{
  uint i;
  for(i=0;i<cicles;i++) HALT;
  return;
}






// TEST 
void test_SC1()
{
  COLOR(LIGHT_GREEN,DARK_GREEN,DARK_GREEN);    
  SCREEN(1);
  //copy to VRAM tileset, only gfx patterns
  CopyToVRAM((uint) TILESET_FONT,BASE7,123*8);  

  VPRINT(24,23,"SCREEN 1");
  
  test();
  
  VPRINT(0,22,"Press any key");
  inkey();  
 
  return;
}



void test_SC2()
{
  COLOR(15,4,14);    
  SCREEN(2);
  FillVRAM(BASE10,0x800,32);
  
  //copy to VRAM tileset,  gfx patterns
  CopyToVRAM((uint) TILESET_FONT,BASE12,123*8);
  CopyToVRAM((uint) TILESET_FONT,BASE12+BANK1,123*8);
  CopyToVRAM((uint) TILESET_FONT,BASE12+BANK2,123*8); 
  
  FillVRAM(BASE11,0x1800,0xF4); 
  
  VPRINT(24,23,"SCREEN 2");
  
  test();  
  
  VPRINT(0,22,"Press a key to exit");
  inkey();  
 
  return;
}



void test()
{
  uint vaddr;
  
  
  VPRINT(0,0,text01);
  VPRINT(0,1,text02);
  
  TwoSeconds();
    
  VPRINT(0,3,">Test VPRINT");
  TwoSeconds();
  VPRINT(3,4,"Alea iacta est");
  TwoSeconds();
  
  VPRINT(0,6,">Test VPRINTN [16chars]");
  TwoSeconds();
  VPRINTN(3,7,"Gaudeamus igitur iuvenes dum sumus",16);
  TwoSeconds();
  
  VPRINT(0,9,">test GetVRAMaddressByPosition()");
  TwoSeconds();
  vaddr = GetVRAMaddressByPosition(5,10);
  VPrintString(vaddr,"col=5,line=10");
  TwoSeconds();

/*en vez de utilizar coordenadas de pantalla, se puede calcular la posicion de
la VRAM y utilizar la función VPokeString. Al no tener que calcular la dirección
la ejecucion sera más rapida*/   
  VPRINT(0,12,">test VPrintString()");
  TwoSeconds(); 
  vaddr = BASE10 + (13*32)+3;
  VPrintString(vaddr,"Ad infinitum");
  TwoSeconds();  
  
  VPRINT(0,15,">Test VPrintNumber(3,16,300,3)");
  TwoSeconds();
  VPrintNumber(3,16,300,3);
  TwoSeconds();
  
  
  VPRINT(0,18,">Test VPrintNum(vaddr,12345,5)");
  TwoSeconds();
  vaddr = BASE10 + (19*32)+3;
  VPrintNum(vaddr,12345,5);
  TwoSeconds();

  //LOCATE(5,14);
  //PRINT("Test printLines function\nYOU WANT TO\nTEST print library?");
  //printLines(5,14,"Test printLines function\nYOU WANT TO\nTEST print library?");
  
  //LOCATE(10,7);
}


void TwoSeconds()
{
    WAIT(50*2);
}